<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssmtest01.dao.UserDao">
    <resultMap id="myOrder" type="com.ssmtest01.bean.User">
        <id column="uid" property="uid"></id>
        <result column="uuidname" property="uuidname"></result>
        <result column="username" property="username" />
        <result column="password" property="password" />
        <result column="himage" property="himage" />
        <result column="phone" property="phone" />
        <result column="email" property="email" />
        <result column="role" property="role" />
        <result column="address" property="address" />
        <result column="money" property="money" />
        <result column="sex" property="sex" />
        <result column="text" property="text" />

        <collection property="order" javaType="list"  ofType="com.ssmtest01.bean.Order"   >
            <id column="oid" property="oid"/>
            <result column="sstate" property="sstate" />
            <result column="bstate" property="bstate" />
            <result column="odate" property="odate" />
            <result column="okdate" property="okdate" />
            <result column="payment" property="payment" />
            <result column="amount" property="amount" />
            <result column="uid" property="uid" />
            <result column="sid" property="sid" />
            <result column="sid" property="cid" />
            <association property="user"    column="uid"  resultMap="user" />
            <association property="commoditys"    column="cid"   resultMap="commodity" />
        </collection>
    </resultMap>

    <resultMap id="user" type="com.ssmtest01.bean.User">
        <id column="uid" property="uid"></id>
        <result column="uuidname" property="uuidname"></result>
        <result column="username" property="username" />
        <result column="password" property="password" />
        <result column="himage" property="himage" />
        <result column="phone" property="phone" />
        <result column="email" property="email" />
        <result column="role" property="role" />
        <result column="address" property="address" />
        <result column="money" property="money" />
        <result column="sex" property="sex" />
        <result column="text" property="text" />
    </resultMap>

    <resultMap id="commodity" type="com.ssmtest01.bean.Commoditys">
        <id column="sid" property="sid"/>
        <result column="uid" property="uid"/>
        <result column="commodity" property="commodity"/>
        <result column="synopsis" property="synopsis"/>
        <result column="price" property="price"/>
        <result column="amount" property="amount"/>
        <result column="simage" property="simage"/>
    </resultMap>


    <select id="selAllUser" resultMap="myOrder" >
        SELECT u.uid,o.*, su.username,su.phone,su.email,su.text,c.*
        from `user` u
                 join shopping_order s_o  on s_o.buyerid=u.uid
                 join  myorder o on o.oid=s_o.oid
                 join  `user` su on o.sid=su.uid
                 join  commoditys c on c.sid=o.cid
        where u.uid=#{uid}

    </select>


    <select id="selUser" resultMap="user">
        SELECT * from `user`
        <where>
            <if test="user != null ">
                <if test="user.uid != null and user.uid != ''">
                    AND uid=#{user.uid}
                </if>
                <if test="user.uuidname != null and user.uuidname != ''">
                    AND uuidname=#{user.uuidname}
                </if>
                <if test="user.username != null and user.username != ''">
                    AND username=#{user.username}
                </if>
                <if test="user.password != null and user.password != ''">
                    AND password=#{user.password}
                </if>
                <if test="user.himage != null and user.himage != ''">
                    AND himage=#{user.himage}
                </if>
                <if test="user.role != null and user.role != ''">
                    AND `role`=#{user.role}
                </if>
                <if test="user.phone != null and user.phone != ''">
                    AND phone=#{user.phone}
                </if>
                <if test="user.email != null and user.email != ''">
                    AND email=#{user.email}
                </if>
                <if test="user.address != null and user.address != ''">
                    AND address=#{user.address}
                </if>
                <if test="user.sex != null and user.sex != ''">
                    AND sex=#{user.sex}
                </if>

            </if>


        </where>


    </select>

    <update id="updataByUser"  parameterType="com.ssmtest01.bean.User">
        update `user`
        <set>
            <if test="user.username != null and user.username != ''">
                username=#{user.username},
            </if>
            <if test="user.password != null and user.password != ''">
                 password=#{user.password},
            </if>
            <if test="user.himage != null and user.himage != ''">
                 himage=#{user.himage},
            </if>
                 role=#{user.role},
            <if test="user.phone != null and user.phone != ''">
                phone=#{user.phone},
            </if>
            <if test="user.email != null and user.email != ''">
               email=#{user.email},
            </if>
            <if test="user.address != null and user.address != ''">
                 address=#{user.address},
            </if>
            <if test="user.sex != null and user.sex != ''">
                 sex=#{user.sex},
            </if>
            <if test="user.text != null and user.text != ''">
                text=#{user.text},
            </if>
            <if test="user.money != null and user.money != 0.0">
                money=#{user.money},
            </if>


        </set>
        where uid=#{user.uid}
    </update>

</mapper>